{% extends "layouts/base.html" %}

{% block content %}
<div class="container mx-auto p-6">
    <h1 class="text-4xl font-bold text-gray-800 mb-2">My Full Progress Report</h1>
    <p class="text-xl text-gray-600 mb-6">A detailed overview of your progress and activities.</p>

    <!-- Download Buttons -->
    <div class="flex space-x-4 mb-8">
        <a href="{{ url_for('main.download_progress_pdf') }}" class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-6 rounded-lg transition-colors">
            Download as PDF
        </a>
        <a href="{{ url_for('main.download_progress_csv') }}" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded-lg transition-colors">
            Download as CSV
        </a>
    </div>

    <div class="space-y-8">
        {% for data in dashboard_data %}
        <div class="bg-white rounded-lg shadow-md p-6 border border-gray-200">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-2xl font-bold text-gray-800">{{ data.course.title }}</h2>
                <a href="{{ url_for('main.dashboard', course_id=data.course.id) }}" class="text-blue-500 hover:underline font-semibold">Go to Course &rarr;</a>
            </div>

            <div class="space-y-4">
                <!-- Course Summary Section -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 bg-gray-50 p-4 rounded-lg border border-gray-100">
                    <div class="text-center">
                        <p class="text-3xl font-bold text-gray-800">{{ data.total_lessons }}</p>
                        <p class="text-sm text-gray-500">Total Lessons</p>
                    </div>
                    <div class="text-center">
                        <p class="text-3xl font-bold text-gray-800">{{ data.discussion_posts }}</p>
                        <p class="text-sm text-gray-500">Discussion Posts</p>
                    </div>
                    <div class="text-center">
                        <p class="text-3xl font-bold text-gray-800">{{ data.discussion_replies }}</p>
                        <p class="text-sm text-gray-500">Discussion Replies</p>
                    </div>
                </div>

                <!-- Assignments Section -->
                <div class="bg-gray-50 p-4 rounded-lg border border-gray-100">
                    <h3 class="text-xl font-semibold text-gray-700 mb-3">Assignments</h3>
                    {% if data.assignments %}
                        <ul class="space-y-2">
                            {% for assignment_data in data.assignments %}
                                <li class="flex items-center justify-between p-3 bg-white rounded-md shadow-sm border border-gray-200">
                                    <div>
                                        <p class="font-medium text-gray-800">{{ assignment_data.assignment.title }}</p>
                                        <p class="text-sm text-gray-500">Due: {{ assignment_data.assignment.due_date.strftime('%b %d, %Y') }}</p>
                                    </div>
                                    <div class="text-right">
                                        {% if assignment_data.status == 'Graded' %}
                                            <p class="text-lg font-bold text-green-600">{{ assignment_data.submission.grade if assignment_data.submission.grade is not none else 'N/A' }}%</p>
                                            <p class="text-sm text-gray-500">{{ assignment_data.status }}</p>
                                        {% elif assignment_data.status == 'Submitted' %}
                                            <p class="text-sm font-semibold text-yellow-600">{{ assignment_data.status }}</p>
                                            <p class="text-xs text-gray-500">Awaiting grade</p>
                                        {% else %}
                                            <p class="text-sm font-semibold text-red-600">{{ assignment_data.status }}</p>
                                            <p class="text-xs text-gray-500">Deadline approaching</p>
                                        {% endif %}
                                    </div>
                                </li>
                            {% endfor %}
                        </ul>
                    {% else %}
                        <p class="text-gray-500 text-sm">No assignments found for this course.</p>
                    {% endif %}
                </div>

                <!-- Quizzes Section -->
                <div class="bg-gray-50 p-4 rounded-lg border border-gray-100">
                    <h3 class="text-xl font-semibold text-gray-700 mb-3">Quizzes</h3>
                    {% if data.quizzes %}
                        <ul class="space-y-2">
                            {% for quiz_data in data.quizzes %}
                                <li class="flex items-center justify-between p-3 bg-white rounded-md shadow-sm border border-gray-200">
                                    <div>
                                        <p class="font-medium text-gray-800">{{ quiz_data.quiz.title }}</p>
                                        <p class="text-sm text-gray-500">Status: {{ quiz_data.status }}</p>
                                    </div>
                                    <div class="text-right">
                                        {% if quiz_data.status == 'Graded' %}
                                            <p class="text-lg font-bold text-green-600">{{ quiz_data.submission.score }}</p>
                                            <p class="text-sm text-gray-500">Score</p>
                                        {% elif quiz_data.status == 'Submitted' %}
                                            <p class="text-sm font-semibold text-yellow-600">{{ quiz_data.status }}</p>
                                            <p class="text-xs text-gray-500">Awaiting grade</p>
                                        {% else %}
                                            <p class="text-sm font-semibold text-red-600">{{ quiz_data.status }}</p>
                                            <p class="text-xs text-gray-500">Not attempted</p>
                                        {% endif %}
                                    </div>
                                </li>
                            {% endfor %}
                        </ul>
                    {% else %}
                        <p class="text-gray-500 text-sm">No quizzes found for this course.</p>
                    {% endif %}
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% endblock %}
